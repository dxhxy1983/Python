<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å±€åŸŸç½‘æŠ¢ç­”å™¨ - æœåŠ¡ç«¯</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", Arial, sans-serif; }
        body { background: #f0f2f5; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: #1a202c; text-align: center; margin-bottom: 40px; font-size: 36px; font-weight: bold; }
        
        /* çŠ¶æ€æç¤ºåŒºåŸŸ */
        .status-card { margin: 30px 0; padding: 25px; border-radius: 12px; font-size: 24px; text-align: center; font-weight: bold; min-height: 120px; display: flex; align-items: center; justify-content: center; }
        .waiting { background: #e6f7ff; color: #1890ff; border: 2px solid #91d5ff; }
        .running { background: #f6ffed; color: #52c41a; border: 2px solid #b7eb8f; }
        .result { background: #fff1f0; color: #f5222d; border: 2px solid #ffccc7; }
        .client-url { font-size: 26px; text-decoration: underline; margin: 0 8px; }
        
        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .control-panel { text-align: center; margin: 40px 0; }
        .btn { padding: 20px 45px; font-size: 28px; border: none; border-radius: 10px; cursor: pointer; margin: 0 15px; font-weight: bold; transition: all 0.2s ease; }
        .start-btn { background: #52c41a; color: white; }
        .start-btn:hover { background: #52c41a; transform: scale(1.05); box-shadow: 0 4px 15px rgba(82, 196, 26, 0.3); }
        .start-btn:disabled { background: #d9d9d9; color: #8c8c8c; cursor: not-allowed; transform: none; box-shadow: none; }
        .reset-btn { background: #fa8c16; color: white; }
        .reset-btn:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(250, 140, 22, 0.3); }
        
        /* å®¢æˆ·ç«¯åˆ—è¡¨åŒºåŸŸ */
        .clients-section { margin-top: 50px; }
        .section-title { color: #1a202c; margin-bottom: 20px; font-size: 30px; font-weight: bold; border-bottom: 3px solid #e8f4f8; padding-bottom: 10px; }
        .client-count-badge { background: #1890ff; color: white; padding: 5px 15px; border-radius: 20px; font-size: 20px; margin-left: 10px; }
        .clients-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 15px; }
        .client-item { background: #f8f9fa; padding: 20px; margin: 0; border-radius: 10px; border-left: 5px solid #1890ff; font-size: 22px; }
        .no-clients { color: #8c8c8c; font-style: italic; padding: 30px; font-size: 22px; text-align: center; background: #fafafa; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>å±€åŸŸç½‘æŠ¢ç­”å™¨ - ä¸»æŒäººæ§åˆ¶å°</h1>
        
        <!-- çŠ¶æ€æç¤ºå¡ç‰‡ -->
        <div class="status-card waiting" id="status">
            ç­‰å¾…ä¸­ï¼Œè¯·é€‰æ‰‹é€šè¿‡æ‰‹æœºè®¿é—®ï¼š<span class="client-url" id="client-url"></span>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <div class="control-panel">
            <button class="btn start-btn" id="start-btn" onclick="startGame()">å¼€å§‹æŠ¢ç­”</button>
            <button class="btn reset-btn" onclick="resetGame()">é‡ç½®æŠ¢ç­”</button>
        </div>
        
        <!-- å®¢æˆ·ç«¯åˆ—è¡¨åŒºåŸŸ -->
        <div class="clients-section">
            <h2 class="section-title">
                å·²è¿æ¥çš„æŠ¢ç­”ç»ˆç«¯ 
                <span class="client-count-badge" id="client-count">{{ client_count }}</span>
            </h2>
            <div class="clients-container" id="clients-container">
                {% if connected_clients %}
                    {% for client_id, client_info in connected_clients.items() %}
                        <div class="client-item">{{ client_info.name }}ï¼ˆè¿æ¥æ—¶é—´ï¼š{{ client_info.join_time }}ï¼‰</div>
                    {% endfor %}
                {% else %}
                    <div class="no-clients">æš‚æ— å®¢æˆ·ç«¯è¿æ¥</div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        // è¿æ¥WebSocket
        const socket = io();
        const startBtn = document.getElementById('start-btn');
        const statusEl = document.getElementById('status');
        const clientsContainer = document.getElementById('clients-container');
        const clientCountEl = document.getElementById('client-count');
        const clientUrlEl = document.getElementById('client-url');
        
        // è·å–å½“å‰é¡µé¢URLï¼Œç”Ÿæˆå®¢æˆ·ç«¯è®¿é—®åœ°å€
        const currentUrl = window.location.href;
        clientUrlEl.textContent = currentUrl + 'client';
        
        // æŠ¢ç­”å¼€å§‹
        function startGame() {
            socket.emit('start_game');
        }
        
        // é‡ç½®æŠ¢ç­”
        function resetGame() {
            socket.emit('reset_game');
        }
        
        // æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥æ›´æ–°
        socket.on('update_clients', (data) => {
            // æ›´æ–°å®¢æˆ·ç«¯æ•°é‡
            clientCountEl.textContent = data.count;
            // æ›´æ–°å®¢æˆ·ç«¯åˆ—è¡¨
            let html = '';
            const clients = data.clients;
            if (Object.keys(clients).length > 0) {
                for (const [clientId, clientInfo] of Object.entries(clients)) {
                    html += `<div class="client-item">${clientInfo.name}ï¼ˆè¿æ¥æ—¶é—´ï¼š${clientInfo.join_time}ï¼‰</div>`;
                }
            } else {
                html = '<div class="no-clients">æš‚æ— å®¢æˆ·ç«¯è¿æ¥</div>';
            }
            clientsContainer.innerHTML = html;
        });
        
        // æ¥æ”¶æ¸¸æˆçŠ¶æ€æ›´æ–°
        socket.on('update_game_status', (data) => {
            if (data.is_started) {
                statusEl.className = 'status-card running';
                startBtn.disabled = true;
            } else if (data.status.includes('æ­å–œ')) {
                statusEl.className = 'status-card result';
                startBtn.disabled = true;
            } else {
                statusEl.className = 'status-card waiting';
                statusEl.textContent = 'å·²é‡ç½®ï¼Œç­‰å¾…ä¸­ï¼Œè¯·é€‰æ‰‹é€šè¿‡æ‰‹æœºè®¿é—®ï¼š' + clientUrlEl.textContent;
                startBtn.disabled = false;
            }
            statusEl.textContent = data.status;
        });
        
        // æ¥æ”¶æŠ¢ç­”ç»“æœ
        socket.on('answer_result', (winner) => {
            statusEl.className = 'status-card result';
            statusEl.textContent = `ğŸ‰ æ­å–œ ${winner.name} æŠ¢ç­”æˆåŠŸï¼å“åº”æ—¶é—´ï¼š${winner.response_time}msï¼ˆ${winner.time}ï¼‰`;
            startBtn.disabled = true;
        });
    </script>
</body>
</html>